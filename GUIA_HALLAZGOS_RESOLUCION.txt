================================================================================
                 📋 GESTIÓN DE HALLAZGOS DE AUDITORÍA
          Sistema de Gestión de Cumplimiento - Frutos de Oro
================================================================================

FUNCIONALIDAD AGREGADA: CERRAR Y RESOLVER HALLAZGOS
====================================================

✅ NUEVAS CARACTERÍSTICAS
-------------------------

1. **Cerrar Hallazgos** (Resolver)
   - Marca un hallazgo como "resuelto"
   - Permite agregar notas de cierre explicando la solución
   - Registra la fecha y hora de cierre
   - Se mantiene el historial del hallazgo

2. **Reabrir Hallazgos**
   - Permite reactivar hallazgos cerrados si es necesario
   - Vuelve al estado "abierto"
   - Útil si el problema resurge

3. **Editar Hallazgos**
   - Modificar descripción, severidad, acción correctiva
   - Cambiar responsable y fecha límite
   - Actualizar estado y notas

4. **Eliminar Hallazgos**
   - Opción para eliminar hallazgos incorrectos
   - Requiere confirmación
   - Acción permanente


================================================================================
🎯 CÓMO USAR - PASO A PASO
================================================================================

CERRAR UN HALLAZGO (Marcar como resuelto)
------------------------------------------

1. Ve a: Auditorías → Ver detalles de una auditoría
2. En la sección "Hallazgos", localiza el hallazgo que deseas cerrar
3. Haz clic en el botón verde con ícono ✓ (Cerrar/Resolver)
4. Se abrirá un modal donde puedes:
   - Agregar notas de cierre (opcional pero recomendado)
   - Explicar cómo se resolvió el problema
5. Haz clic en "Cerrar Hallazgo"
6. ✅ El hallazgo aparecerá con fondo gris y badge verde "CERRADO"


REABRIR UN HALLAZGO
-------------------

1. Ve a: Auditorías → Ver detalles de una auditoría
2. Localiza un hallazgo cerrado (fondo gris, badge verde)
3. Haz clic en el botón naranja con ícono ↻ (Reabrir)
4. Confirma la acción
5. ✅ El hallazgo volverá al estado "ABIERTO"


EDITAR UN HALLAZGO
------------------

1. Ve a: Auditorías → Ver detalles de una auditoría
2. Haz clic en el botón azul con ícono ✎ (Editar)
3. Modifica los campos necesarios:
   - Descripción
   - Severidad (Crítica, Mayor, Menor)
   - Acción correctiva
   - Responsable
   - Fecha límite
   - Estado (Abierto/Cerrado)
   - Notas
4. Haz clic en "Actualizar Hallazgo"
5. ✅ Los cambios se guardarán


ELIMINAR UN HALLAZGO
--------------------

1. Ve a: Auditorías → Ver detalles de una auditoría
2. Haz clic en el botón rojo con ícono 🗑 (Eliminar)
3. Confirma que deseas eliminar (acción permanente)
4. ✅ El hallazgo será eliminado


================================================================================
🎨 INDICADORES VISUALES
================================================================================

ESTADOS DE HALLAZGOS:
---------------------

  🟡 ABIERTO
     • Badge amarillo con "ABIERTO"
     • Fondo blanco
     • Botones disponibles: Editar ✎ | Cerrar ✓ | Eliminar 🗑
  
  🟢 CERRADO
     • Badge verde con "CERRADO ✓"
     • Fondo gris claro
     • Muestra fecha de cierre
     • Botones disponibles: Editar ✎ | Reabrir ↻ | Eliminar 🗑


SEVERIDAD:
----------

  🔴 CRÍTICA   - Badge rojo
  🟡 MAYOR     - Badge amarillo
  🔵 MENOR     - Badge azul


ALERTAS DE VENCIMIENTO:
-----------------------

  🔴 VENCIDO        - Badge rojo "Vencido (X días)"
  🟡 VENCE PRONTO   - Badge amarillo "Vence pronto (X días)" (≤ 7 días)
  ⚪ NORMAL         - Sin alerta (> 7 días)


================================================================================
📊 PANEL DE RESUMEN
================================================================================

El panel lateral derecho muestra:

• **Total de Hallazgos**: Cantidad total registrados
• **Hallazgos Críticos**: Contador en rojo
• **Hallazgos Mayores**: Contador en amarillo
• **Hallazgos Menores**: Contador en azul
• **Cumplimiento**: Barra de progreso (hallazgos cerrados / total)
• **Alerta**: Mensaje si hay hallazgos críticos pendientes


CÁLCULO DE CUMPLIMIENTO:
-------------------------

Cumplimiento % = (Hallazgos Cerrados / Total Hallazgos) × 100

Ejemplo:
- Total: 10 hallazgos
- Cerrados: 7
- Cumplimiento: 70%


================================================================================
💡 BUENAS PRÁCTICAS
================================================================================

1. **Siempre agregar notas de cierre**
   ✅ Explica qué se hizo para resolver el hallazgo
   ✅ Facilita auditorías futuras
   ✅ Mantiene historial de acciones

2. **Revisar antes de cerrar**
   ✅ Verifica que la acción correctiva se haya completado
   ✅ Confirma que el problema está resuelto
   ✅ Documenta evidencias si es necesario

3. **Priorizar hallazgos críticos**
   🔴 Atender primero los críticos
   🟡 Luego los mayores
   🔵 Finalmente los menores

4. **Actualizar fechas límite**
   ✅ Si un hallazgo no se puede resolver a tiempo, actualiza la fecha
   ✅ Documenta el motivo del retraso en las notas

5. **Usar reabrir solo si es necesario**
   ⚠️ Solo reabre si el problema realmente resurge
   ✅ Considera crear un nuevo hallazgo en lugar de reabrir


================================================================================
🔐 PERMISOS
================================================================================

Todas las acciones requieren estar autenticado.

Los roles tienen estos permisos:

  ADMINISTRADOR:
  ✅ Ver, crear, editar, cerrar, reabrir, eliminar hallazgos

  JEFE DE UNIDAD:
  ✅ Ver, crear, editar, cerrar hallazgos de su área
  ⚠️ Consultar política de permisos de eliminación

  AUDITOR:
  ✅ Ver, crear, editar, cerrar, reabrir hallazgos

  USUARIO:
  ✅ Ver hallazgos
  ⚠️ Consultar permisos específicos


================================================================================
📝 REGISTRO DE AUDITORÍA
================================================================================

El sistema registra automáticamente:

• Fecha y hora de cierre de hallazgos
• Usuario que cerró el hallazgo
• Fecha y hora de reapertura (si aplica)
• IP del usuario que realizó la acción
• Todas las acciones quedan en el log de auditoría


================================================================================
❓ PREGUNTAS FRECUENTES
================================================================================

P: ¿Qué pasa si cierro un hallazgo por error?
R: Puedes reabrirlo usando el botón "Reabrir" (↻)

P: ¿Puedo editar un hallazgo cerrado?
R: Sí, usa el botón "Editar". Podrás modificar la información.

P: ¿Se pierde información al cerrar un hallazgo?
R: No, toda la información se mantiene. Solo cambia el estado.

P: ¿Cómo sé cuándo se cerró un hallazgo?
R: Los hallazgos cerrados muestran la fecha y hora de cierre.

P: ¿Puedo eliminar un hallazgo cerrado?
R: Sí, los hallazgos cerrados también se pueden eliminar.

P: ¿Qué pasa con los hallazgos al completar una auditoría?
R: Los hallazgos se mantienen. Solo cambia el estado de la auditoría.

P: ¿Se envían notificaciones al cerrar hallazgos?
R: Actualmente no, pero se puede implementar en futuras versiones.


================================================================================
🚀 RUTAS DE LA API (Para desarrolladores)
================================================================================

POST /audits/<audit_id>/findings/<finding_id>/close
  - Cierra un hallazgo
  - Parámetros: closure_notes (opcional)

POST /audits/<audit_id>/findings/<finding_id>/reopen
  - Reabre un hallazgo cerrado

GET/POST /audits/<audit_id>/findings/<finding_id>/edit
  - Edita un hallazgo existente

POST /audits/<audit_id>/findings/<finding_id>/delete
  - Elimina un hallazgo


================================================================================
📅 FLUJO TÍPICO DE UN HALLAZGO
================================================================================

1. CREACIÓN
   ├─ Se registra durante o después de la auditoría
   ├─ Estado inicial: ABIERTO
   └─ Se asigna responsable y fecha límite

2. SEGUIMIENTO
   ├─ Se monitorea el progreso
   ├─ Se actualizan notas si es necesario
   └─ Se verifica cumplimiento de acción correctiva

3. RESOLUCIÓN
   ├─ Se implementa la acción correctiva
   ├─ Se verifica que el problema está resuelto
   └─ Se CIERRA el hallazgo con notas de cierre

4. VERIFICACIÓN
   ├─ Se valida que la solución funciona
   ├─ Si el problema resurge → REABRIR
   └─ Si está resuelto → Mantener CERRADO


================================================================================
✅ CHECKLIST ANTES DE CERRAR UN HALLAZGO
================================================================================

Antes de cerrar un hallazgo, verifica:

[ ] La acción correctiva fue implementada completamente
[ ] El problema que causó el hallazgo está resuelto
[ ] Se documentó la solución en las notas de cierre
[ ] El responsable confirmó la resolución
[ ] Se tienen evidencias de la corrección (si aplica)
[ ] No hay problemas residuales relacionados


================================================================================
¡LISTO! 🎉
================================================================================

Ahora puedes gestionar completamente el ciclo de vida de los hallazgos:
Crear → Seguir → Resolver → Cerrar → Verificar

Para más información consulta:
• README.md - Documentación general del sistema
• INDICE_DOCUMENTACION.txt - Índice de toda la documentación
